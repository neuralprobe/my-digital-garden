---
title: Warehouse-Scale Computers to Exploit Request-Level and Data-Level Parallelism
date: 2023-07-29
tags:
  - ComputerArchitecture
  - RequestLevelParallelism
  - Multiprocessing
  - HennessyPatterson
  - Warehouse
  - DataCenter
  - SuperComputer
---

# Warehouse-Scale Computers to Exploit Request-Level and Data-Level Parallelism

- Chapter 6 in [Computer Architecture A Quantitative Approach (6th)](https://www.elsevier.com/books/computer-architecture/hennessy/978-0-12-811905-1) by Hennessy and Patterson (2017)

![[Pasted image 20230704112602.png]]

---

# Introduction

**Warehouse-scale computer (WSC)**
- Foundation of ==Internet services== billions of people use every day
- Modern descendant of the supercomputer
	- Seymour Cray as the godfather of WSC architects
	- Information technology for the world instead of high performance computing (HPC) for scientists and engineers

**Characteristics of WSC**
- Tasks: 
	- Search, social networking, online maps, video sharing, online shopping, email services, cloud computing and so on
- Costs:
	- 10M dollars for the building
	- Electrical, cooling infrastructure
	- Servers
	- Networking equipment that connects 50,000-100,000 servers
- Skills:
	- Designing for scale
	- Designing for dependability
	- Knack for debugging hardware
- Goals:
	- Shared with server architects
		- Cost-performance
		- Energy efficiency
		- Dependability via redundancy
		- Network I/O
		- Both interactive and batch processing workloads
			- eg. MapReduce
	- Not shared with server architects
		- Ample parallelism
			- Data-level parallelism: eg. web pages from a web crawl
			- Request-level parallelism: Easy parallelism in SaaS with little dependence between  requests (Read/write requests in email services)
		- Operational costs 
			- Due to longer lifetimes ~ 10-15 years
			- Energy, power distribution, cooling ~ 30%
		- Location 
			- Where to build the warehouse?
			- Access to water, inexpensive electricity, proximity to back-bone optical fibers
			- People nearby to work in WSC
		- Computing efficiently at low utilization
		- Scale and the opportunities/problems associated with scale
			- Failures: A server with MTTF of 25 years $\rightarrow$ 5 server failures a day

![[Pasted image 20230811113714.png]]

---

# Programming Models and Workloads for Warehouse-Scale Computers

[MapReduce](https://research.google.com/archive/mapreduce-osdi04.pdf) (Dean and Ghemawat, 2008)
- A popular framework for batch processing in a WSC
	- Inspired by Lisp functions
	- Its open-source twin = Hadoop
- Map 
	- First applies a programmer-supplied function to each logical input record
	- Runs on hundreds of computers to produce an intermediate result of key-value pairs
- Reduce
	- Collects the output of those distributed tasks and collapses them using another programmer-defined function
	- If the reduce function is commutative and associative $\rightarrow$ `log-N` time
- 

![[Pasted image 20230811115419.png]]

A MapReduce program that calculates the number of occurrences of every English word in a large collection of documents
- `EmitIntermediate` in `map`: Emits each word in the document and the value one
- `ParseInt()` in `reduce`: Sums all the values per word for each document
- MapReduce runtime environment schedules map tasks and reduce tasks to the nodes of a WSC
![[Pasted image 20230917174958.png]]

Performance heterogeneity & Tail latency
- A single slow task can hold up completion of a large MapReduce job
- The system will start backup executions on other nodes of the tasks that haven’t completed yet and take the result from whichever finishes first.

Dependability built into MapReduce
- Each node in a MapReduce job is required to report back to the master node periodically with a list of completed tasks and with updated status
- If a node does not report back by the deadline, the master node deems the node dead and reassigns the node’s work to other nodes.

File system
- MapReduce relies on the Google File System (GFS) (Ghemawat et al., 2003) or on Colossus (Fikes, 2010) to supply files to any computer, so that MapReduce tasks can be scheduled anywhere
- These systems often make complete replicas of the data. Replicas can help with read performance as well as with availability; with proper placement, replicas can overcome many other system failures
- Colossus use error-correcting codes 

Considerably varying workload demands of Google's public interactive services
![[Pasted image 20230918085728.png]]

# Computer Architecture of Warehouse-Scale Computers

Networks
- Connective tissue that binds 50,000-100,000 servers together
- WSCs use a hierarchy of networks

![[Pasted image 20230918091925.png]]

Rack vs Array of racks
- 19-inch wide or wider
- 6-7 ft
- 40-80 servers
- ToR (top of rack) switches
- BW between servers in a rack >> BW between racks
- 4-16 uplinks to go to the next higher switch in the network hierarchy
- Oversubscription problem: BW leaving a rack ~ 1/6 ~ 1/24 BW within the rack 
- So, developer should know the impact of placing sender and receiver on the performance consequences
- Switch within an array of racks?
	- More expensive than the ToR switch
	- Should provide huge BW to reduce oversubscription problem
	- $n$ ports? $\rightarrow$ $n^2$ cost

## Storage
- Option \#1: Storage in each rack rely on Ethernet connectivity 
- Option \#2: Network-attached storage (NAS) over a storage network like InifiniBand
- File system (GFS or others) maintains replicas to overcome dependability problems
	- cf. RAID-like error correction codes

## WSC Memory Hierarchy

![[Pasted image 20230918124335.png]]

![[Pasted image 20230918124419.png]]

WSC with 10s of arrays? $\rightarrow$ Need one more level in the networking hierarchy $\rightarrow$ Conventional Layer 3 routers to connect the arrays together and to the Internet
![[Pasted image 20230918125311.png]]

# The Efficiency and Cost of Warehouse-Scale Computers

Infrastructure costs for power distribution and cooling $\rightarrow$ the majority of the construction costs of a WSC
- Computer room air-conditioning (CRAC)
- 






---

# Reference

- Chapter 6 in [Computer Architecture A Quantitative Approach (6th)](https://www.elsevier.com/books/computer-architecture/hennessy/978-0-12-811905-1) by Hennessy and Patterson (2017)
- Notebook: [[Computer Architecture Quantitive Approach]]

